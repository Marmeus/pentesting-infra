#!/bin/bash
cp docker-compose-bkp.yml docker-compose.yml

if [ "$#" -lt 2 ]; then
    echo "Usage: $0 '<PIHOLE_PASS>' '<EXTERNAL_IP>'"
    exit 1
fi

sed -i "s/<PIHOLE_PASSWD>/$1/g" docker-compose.yml
sed -i "s/<YOUR_EXTERNAL_IP>/$2/g" docker-compose.yml

# Gitea
mkdir -p ./Gitea/{data,config,backup}
sudo chown 1000:1000 ./Gitea/{config/,data/,backup/}

# PwnDoc
git clone https://github.com/pwndoc/pwndoc PwnDoc
cp docker-compose-pwndoc.yml ./PwnDoc/docker-compose.yml

# Nginx
mkdir -p ./Nginx/{conf.d,ssl}
cp default.conf ./Nginx/conf.d/default.conf
cd ./Nginx/ssl && openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout nginx-selfsigned.key -out nginx-selfsigned.crt
cd -

# Execute
docker compose up -d